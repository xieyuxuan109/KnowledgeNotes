## 1. 解锁与模式切换

在发送控制指令之前，无人机需要处于解锁状态，并且飞控模式需要切换到 `OFFBOARD`，然后控制状态切换到 `COMMAND_CONTROL`。

1).  **解锁无人机 (Arming)**：
    通常通过遥控器或地面站进行解锁操作。如果您需要通过 ROS 命令解锁，可以使用 `mavros` 服务。以下是一个示例命令，但请注意，这通常需要无人机处于安全模式（如 `STABILIZED` 或 `POSCTL`）且满足解锁条件。
    ```bash
    rosservice call /uav1/mavros/cmd/arming true
    ```

2).  **切换到 OFFBOARD 模式**：
    这是允许外部计算机（即机载电脑）控制无人机的关键模式。同样，这通常通过遥控器或地面站的模式切换开关完成。通过 ROS 命令切换示例如下：
    ```bash
    rosservice call /uav1/mavros/set_mode "custom_mode: 'OFFBOARD'"
    ```

3).  **切换到指令控制模式 (COMMAND_CONTROL)**：
    这是 `prometheus_uav_control` 内部定义的状态，允许 `uav_command_pub` 节点发送的指令被执行。您可以通过发布一个 `UAVSetup` 消息来完成此操作。
    ```bash
    rostopic pub -1 /uav1/prometheus/setup prometheus_msgs/UAVSetup "cmd: 6
control_state: 'COMMAND_CONTROL'"
    ```
    *注意：根据 `uav_controller.cpp` 中的 `uav_setup_cb` 函数，`cmd` 为 6 对应 `SET_CONTROL_MODE`。*

## 2. 运行指令发布节点并控制无人机

当主节点正在运行且无人机已准备就绪后，您可以启动指令发布节点，并通过交互式终端发送飞行命令。

1).  **启动指令发布节点**：
    打开 **第三个** 独立的终端，并执行以下命令：
    ```bash
    roslaunch prometheus_uav_control uav_command_pub.launch
    ```

2).  **在终端中输入指令**：
    启动后，该终端将显示一个菜单，提示您输入数字来选择不同的飞行动作。根据您之前的请求，以下是基本操作的对应指令：

    *   **起飞并悬停**：
        -   输入 `1` (Move in ENU frame)。
        -   当提示输入 `x, y, z` 时，输入 `0`, `0`, `1.0` (或您期望的起飞高度)。
        -   当提示输入 `yaw` 时，输入 `0`。
        -   无人机将自动起飞并悬停在当前位置上方 1 米处。

    *   **前进**：
        -   输入 `2` (Move in BODY frame)。
        -   当提示输入 `x, y, z` 时，输入您希望前进的距离（例如 `2.0`），`y` 和 `z` 输入 `0`。
        -   无人机将向机头方向前进指定距离。

    *   **后退**：
        -   输入 `2` (Move in BODY frame)。
        -   当提示输入 `x, y, z` 时，输入一个负值（例如 `-2.0`），`y` 和 `z` 输入 `0`。
        -   无人机将向后退指定距离。

    *   **降落**：
        -   输入 `4` (Land)。
        -   无人机将在当前位置自动降落并上锁。

## 3.终端操作流程概览

| 终端 1 | 终端 2 (启动后) | 终端 3 (启动后) |
| :--- | :--- | :--- |
| `roslaunch prometheus_uav_control uav_control_main_indoor.launch` | `rosservice call /uav1/mavros/cmd/arming true` | `roslaunch prometheus_uav_control uav_command_pub.launch` |
| (保持运行) | `rosservice call /uav1/mavros/set_mode "custom_mode: 'OFFBOARD'"` | (根据提示输入 `1`, `2`, `3`, `4` 等) |
| (保持运行) | `rostopic pub -1 /uav1/prometheus/setup ...` | (根据提示输入坐标或速度) |